# Render Blueprint for PKMN/OP Binder Microservices
# This file defines all the services needed to run the backend on Render

databases:
  - name: catalog-db
    databaseName: catalog_db
    user: postgres
    plan: free

  - name: collection-db
    databaseName: collection_db
    user: postgres
    plan: free

services:
  # RabbitMQ - Using CloudAMQP addon
  # Note: You'll need to add CloudAMQP from Render dashboard (free tier available)

  # Redis for rate limiting
  - type: redis
    name: redis
    plan: free
    maxmemoryPolicy: noeviction

  # API Gateway
  - type: web
    name: api-gateway
    runtime: docker
    dockerfilePath: ./api-gateway/Dockerfile
    dockerContext: .
    plan: free
    healthCheckPath: /actuator/health
    envVars:
      - key: REDIS_HOST
        fromService:
          name: redis
          type: redis
          property: host
      - key: REDIS_PORT
        fromService:
          name: redis
          type: redis
          property: port
      - key: RABBITMQ_HOST
        value: # Add CloudAMQP hostname from dashboard
      - key: RABBITMQ_PORT
        value: 5672
      - key: RABBITMQ_USER
        value: # Add CloudAMQP username
      - key: RABBITMQ_PASS
        value: # Add CloudAMQP password

  # Catalog Service
  - type: web
    name: catalog-service
    runtime: docker
    dockerfilePath: ./catalog-service/Dockerfile
    dockerContext: ./catalog-service
    plan: free
    healthCheckPath: /actuator/health
    envVars:
      - key: DB_HOST
        fromDatabase:
          name: catalog-db
          property: host
      - key: DB_PORT
        fromDatabase:
          name: catalog-db
          property: port
      - key: DB_NAME
        fromDatabase:
          name: catalog-db
          property: database
      - key: DB_USER
        fromDatabase:
          name: catalog-db
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: catalog-db
          property: password
      - key: RABBITMQ_HOST
        value: # Add CloudAMQP hostname
      - key: RABBITMQ_PORT
        value: 5672
      - key: RABBITMQ_USER
        value: # Add CloudAMQP username
      - key: RABBITMQ_PASS
        value: # Add CloudAMQP password

  # Collection Service
  - type: web
    name: collection-service
    runtime: docker
    dockerfilePath: ./collection-service/Dockerfile
    dockerContext: .
    plan: free
    healthCheckPath: /actuator/health
    envVars:
      - key: DB_HOST
        fromDatabase:
          name: collection-db
          property: host
      - key: DB_PORT
        fromDatabase:
          name: collection-db
          property: port
      - key: DB_NAME
        fromDatabase:
          name: collection-db
          property: database
      - key: DB_USER
        fromDatabase:
          name: collection-db
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: collection-db
          property: password
      - key: RABBITMQ_HOST
        value: # Add CloudAMQP hostname
      - key: RABBITMQ_PORT
        value: 5672
      - key: RABBITMQ_USER
        value: # Add CloudAMQP username
      - key: RABBITMQ_PASS
        value: # Add CloudAMQP password

  # Media Service
  - type: web
    name: media-service
    runtime: docker
    dockerfilePath: ./media-service/Dockerfile
    dockerContext: ./media-service
    plan: free
    healthCheckPath: /health
